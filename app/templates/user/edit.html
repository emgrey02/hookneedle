{% extends 'base.html' %} {% block header %} {% block title %}Edit Profile{%
endblock %} {% endblock %} {% block content %}
<div class="form-ctn">
	<form
		method="POST"
		class="grid gap-4 max-w-[500px]"
		enctype="multipart/form-data"
	>
		<div class="field">
			<label class="label">Username</label>
			<input
				class="input"
				type="text"
				placeholder="Username"
				name="username"
				value="{{ user.username }}"
			/>
		</div>
		<div class="field">
			<label
				for="image"
				class="file-label"
			>
				Profile Image
			</label>
			<input
				id="image"
				class="file-input"
				type="file"
				name="image"
				accept="image/png, image/jpeg, image/jpg"
			/>
		</div>
		<div class="field">
			<label class="label">Bio</label>

			<textarea
				class="input"
				placeholder="Write a short bio for yourself!"
				name="bio"
			>
{{ profile.bio }}</textarea
			>
		</div>
		<div class="field">
			<button
				type="submit"
				class="button is-link"
			>
				Submit
			</button>
		</div>
	</form>
</div>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		let fileType = '{{ profile["image_mimetype"]}}';
		let fileBits = '{{ profile["image_data"]}}';
		let fileName = '{{ profile["image_filename"]}}';

		// https://www.geeksforgeeks.org/javascript/how-to-convert-base64-to-file-in-javascript/
		convertBase64ToBlob = (base64Image) => {
			// Split into two parts
			const base64Data = base64Image.replace(/^data:.+;base64,/, '');

			// Hold the content type
			const imageType = fileType;

			// Decode Base64 string
			const decodedData = atob(base64Data);
			console.log(decodedData);

			const byteNumbers = new Array(decodedData.length);

			// Insert all character code into uInt8Array
			for (let i = 0; i < decodedData.length; ++i) {
				byteNumbers[i] = decodedData.charCodeAt(i);
			}

			// Return BLOB image after conversion
			const byteArray = new Uint8Array(byteNumbers);
			return new Blob([byteArray], { type: imageType });
		};

		blob = convertBase64ToBlob(fileBits);
		const fileInput = document.querySelector('#image');

		const myFile = new File([blob], fileName, {
			type: fileType,
			lastModified: new Date(),
		});

		const dataTransfer = new DataTransfer();
		dataTransfer.items.add(myFile);
		fileInput.files = dataTransfer.files;
	});
</script>
{% endblock %}
