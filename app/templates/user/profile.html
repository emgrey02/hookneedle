{% extends 'base.html' %}
{% block header %}
    {% block title %}Profile{% endblock %}
{% endblock %}
{% block content %}
    <div class="flex w-full justify-end gap-4">
        <!-- if this user profile is the current user's profile -->
        {% if g.user['id'] == user.id %}
            <a class="button" href="{{ url_for('user.edit', id=user.id) }}">Update Profile</a>
            <!-- this is another user's profile -->
        {% else %}
            <!-- loop through logged-in-user's friends -->
            {% if friends %}
                <!-- if logged-in-user is friends with this user-->
                <div class="text-green-500">✓ Your Friend!</div>
            {% elif acceptFriendRequest %}
                <button id="add-friend" class="button is-secondary">Accept Friend Request</button>
            {% elif friendshipRequested %}
                <div class="text-yellow-400">✓ Friendship Requested</div>
            {% elif addFriendBtn %}
                <button id="add-friend" class="button">Add Friend</button>
            {% endif %}
        {% endif %}
    </div>
    <div class="flex flex-col gap-4">
        <h2>{{ user.username }}</h2>
        <div class="img-ctn">
            {% if not profile['image_data'] %}
                <div class="bg-gray-700 w-full h-full grid place-items-center">
                    <img height="400"
                         width="400"
                         src="{{ url_for('static', filename='logo.svg') }}"
                         alt="hookneedle logo because no image available" />
                </div>
            {% else %}
                <img height="400"
                     width="400"
                     src="{{ profile['image_data'] }}"
                     alt="image of {{ user.username }}" />
            {% endif %}
        </div>
        <div>
            <h3>Bio</h3>
            {% if profile.bio %}
                <p>{{ profile.bio }}</p>
            {% else %}
                <p>n/a</p>
            {% endif %}
        </div>
        {% if projects %}
            <div>
                <h3>PROJECTS</h3>
                <ul>
                    {% for project in projects %}
                        <li>
                            <a href="/project/{{ project.id }}">{{ project.name }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
        <div>
            <h3>Friends</h3>
            {% if userFriends %}
                <ul>
                    {% for friend in userFriends %}
                        <li>
                            <a href='/user/profile/{{ friend["user2_id"] }}'>{{ friend.username }}</a>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
    </div>
    <script>
	document.addEventListener('DOMContentLoaded', () => {
		friendId = '{{ user.id }}';

		addFriendBtn = document.querySelector('#add-friend');

		addFriendBtn?.addEventListener('click', () => {
			fetch(`/user/addfriend/${friendId}`, {
				method: 'POST',
			}).then(()=> window.location.replace(`/user/profile/${friendId}`)).catch((error) => console.error('CAUGHT ERROR ON POST', error));
		});
	});
    </script>
{% endblock %}
